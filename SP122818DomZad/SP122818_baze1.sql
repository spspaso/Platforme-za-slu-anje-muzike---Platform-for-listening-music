CREATE TABLE SP122818_Izvodjac (
ID_IZVODJACA INTEGER PRIMARY KEY,
IME VARCHAR(50) NOT NULL,
KRATKA_BIOGRAFIJA VARCHAR(200) NOT NULL,
BEND NUMBER(1) NOT NULL
);


CREATE TABLE SP122818_Album (
ID_ALBUMA INTEGER PRIMARY KEY,
NAZIV VARCHAR(100) NOT NULL,
DATUM_OBJAVE DATE NOT NULL,
ID_IZVODJACA INTEGER NOT NULL,
CONSTRAINT FK_ID_IZVODJACA
FOREIGN KEY (ID_IZVODJACA)
REFERENCES SP122818_Izvodjac (ID_IZVODJACA)
);

CREATE TABLE SP122818_Pesma (
ID_PESME INTEGER PRIMARY KEY,
NAZIV VARCHAR(50),
TRAJANJE INTERVAL DAY(0) TO SECOND(6),
ID_ALBUMA INTEGER NOT NULL,
CONSTRAINT FK_ID_ALBUMA 
FOREIGN KEY (ID_ALBUMA)
REFERENCES SP122818_Album (ID_ALBUMA)
);


CREATE TABLE SP122818_Reklama (
ID_REKLAME INTEGER PRIMARY KEY,
NAZIV VARCHAR (50) NOT NULL,
CENA_RSD REAL NOT NULL,
TRAJANJE INTERVAL DAY(0) TO SECOND(6)
);

CREATE TABLE SP122818_Korisnik (
ID_KORISNIKA INTEGER PRIMARY KEY,
USERNAME VARCHAR(50),
PASSWORD VARCHAR(50),
PREMIUM NUMBER(1)
);

CREATE TABLE SP122818_Slusanje (
ID_SLUSANJA INTEGER PRIMARY KEY,
DATUM_VREME TIMESTAMP NOT NULL,
ID_KORISNIKA INTEGER NOT NULL,
ID_PESME INTEGER NOT NULL,
ID_REKLAME INTEGER,
CONSTRAINT FK_ID_KORISNIKA
FOREIGN KEY (ID_KORISNIKA)
REFERENCES SP122818_Korisnik (ID_KORISNIKA),
CONSTRAINT FK_ID_PESME
FOREIGN KEY (ID_PESME)
REFERENCES SP122818_Pesma (ID_PESME),
CONSTRAINT FK_ID_REKLAME
FOREIGN KEY (ID_REKLAME)
REFERENCES SP122818_Reklama (ID_REKLAME)
);


INSERT INTO SP122818_Izvodjac (ID_IZVODJACA, IME, KRATKA_BIOGRAFIJA, BEND)
VALUES (1, 'Pavarotti', 'Lucano Pavaoti bio je italijanski operski pevac', 0);

INSERT INTO SP122818_Izvodjac (ID_IZVODJACA, IME, KRATKA_BIOGRAFIJA, BEND)
VALUES (2, 'Andrea Bocelli', 'Andea Boceli italijanski je tenor', 0);

INSERT INTO SP122818_Izvodjac (ID_IZVODJACA, IME, KRATKA_BIOGRAFIJA, BEND)
VALUES (3, 'duo Moderato', 'Bend je zasnvan na stilizaciji i obradama etno pesama Balkana', 1);


INSERT INTO SP122818_Album (ID_ALBUMA, NAZIV, DATUM_OBJAVE, ID_IZVODJACA)
VALUES (1, 'The Ultimate Collection', '10-Sep-2007', 1);

INSERT INTO SP122818_Album (ID_ALBUMA, NAZIV, DATUM_OBJAVE, ID_IZVODJACA)
VALUES (2, 'Bocelli', '13-Nov-1995', 2);

INSERT INTO SP122818_Album (ID_ALBUMA, NAZIV, DATUM_OBJAVE, ID_IZVODJACA)
VALUES (3, 'Romanza', '23-Oct-1997', 2);

INSERT INTO SP122818_Album (ID_ALBUMA, NAZIV, DATUM_OBJAVE, ID_IZVODJACA)
VALUES (4, 'Dance for Two', '01-Mar-2011', 3);


INSERT INTO SP122818_Pesma (ID_PESME, NAZIV, TRAJANJE, ID_ALBUMA)
VALUES (1, 'Caruso', '0 00:05:19.000000', 1);

INSERT INTO SP122818_Pesma (ID_PESME, NAZIV, TRAJANJE, ID_ALBUMA)
VALUES (2, 'Nessun dorna', '0 00:03:12.000000', 1);

INSERT INTO SP122818_Pesma (ID_PESME, NAZIV, TRAJANJE, ID_ALBUMA)
VALUES (3, 'Vivo per lei', '0 00:04:25.000000', 2);

INSERT INTO SP122818_Pesma (ID_PESME, NAZIV, TRAJANJE, ID_ALBUMA)
VALUES (4, 'Con Te Partiro', '0 00:04:11.000000', 3);

INSERT INTO SP122818_Pesma (ID_PESME, NAZIV, TRAJANJE, ID_ALBUMA)
VALUES (5, 'Svilen konac', '0 00:03:59.000000', 4);

INSERT INTO SP122818_Pesma (ID_PESME, NAZIV, TRAJANJE, ID_ALBUMA)
VALUES (6, 'Dance for two', '0 00:03:42.000000', 4);


INSERT INTO SP122818_Reklama (ID_REKLAME, NAZIV, CENA_RSD, TRAJANJE)
VALUES (1, 'Gillete', 200,  '0 00:00:10.000000');

INSERT INTO SP122818_Reklama (ID_REKLAME, NAZIV, CENA_RSD, TRAJANJE)
VALUES (2, 'Hrana za pse Petcity', 150,  '0 00:00:04.123456');

INSERT INTO SP122818_Reklama (ID_REKLAME, NAZIV, CENA_RSD, TRAJANJE)
VALUES (3, 'Turisticka organizacija', 500,  '0 00:03:04.123006');

INSERT INTO SP122818_Korisnik (ID_KORISNIKA, USERNAME, PASSWORD, PREMIUM)
VALUES (1, 'korisnik1', '123', 1);

INSERT INTO SP122818_Korisnik (ID_KORISNIKA, USERNAME, PASSWORD, PREMIUM)
VALUES (2, 'korisnik2', '321', 0);

INSERT INTO SP122818_Slusanje (ID_SLUSANJA, DATUM_VREME, ID_PESME, ID_KORISNIKA, ID_REKLAME)
VALUES (1, '10-Nov-2025 07:54:00 PM', 3, 1, 1);


INSERT INTO SP122818_Slusanje (ID_SLUSANJA, DATUM_VREME, ID_PESME, ID_KORISNIKA, ID_REKLAME)
VALUES (2, '11-Nov-2025 07:00:00 PM', 3, 1, NULL);

INSERT INTO SP122818_Slusanje (ID_SLUSANJA, DATUM_VREME, ID_PESME, ID_KORISNIKA, ID_REKLAME)
VALUES (3, '11-Nov-2025 09:00:00 PM', 3, 2, 2);


INSERT INTO SP122818_Slusanje (ID_SLUSANJA, DATUM_VREME, ID_PESME, ID_KORISNIKA, ID_REKLAME)
VALUES (4, '11-Nov-2025 09:00:00 PM', 3, 1, 2);

INSERT INTO SP122818_Slusanje (ID_SLUSANJA, DATUM_VREME, ID_PESME, ID_KORISNIKA, ID_REKLAME)
VALUES (5, '11-Nov-2025 09:15:00 PM', 1, 1, 1);

INSERT INTO SP122818_Slusanje (ID_SLUSANJA, DATUM_VREME, ID_PESME, ID_KORISNIKA, ID_REKLAME)
VALUES (6, '14-Nov-2025 09:15:00 PM', 1, 1, 1);


Najlusaniji izvodjac i broj puta:

With NajslusanijiIzvodjac AS (
SELECT i.ime as Izvodjac,
    COUNT(s.ID_SLUSANJA) AS UkupanBroj
FROM SP122818_Slusanje s
JOIN SP122818_Pesma p on s.id_pesme=p.id_pesme
JOIN SP122818_Album a on p.id_albuma=a.id_albuma
JOIN SP122818_Izvodjac i on a.id_izvodjaca=i.id_izvodjaca
GROUP BY i.ime
)

SELECT Izvodjac, UkupanBroj
FROM NajslusanijiIzvodjac
WHERE UkupanBroj = (
    SELECT MAX(UkupanBroj)
    FROM NajslusanijiIzvodjac
);



Reklame koje su slusane vise od 2 puta, povecati cenu 20%:

UPDATE SP122818_Reklama r
SET r.cena_rsd = r.cena_rsd * 1.2
WHERE r.id_reklame in (
    SELECT s.id_reklame
    FROM SP122818_Slusanje s
    GROUP BY s.id_reklame
    HAVING COUNT (*) > 2
    );


Obrisati korisnika koji je prethodno slusao muziku:
DELETE FROM SP122818_SLUSANJE
WHERE ID_KORISNIKA = (SELECT ID_KORISNIKA FROM SP122818_KORISNIK WHERE USERNAME ='korisnik2');

DELETE FROM SP122818_KORISNIK
WHERE USERNAME ='korisnik2';